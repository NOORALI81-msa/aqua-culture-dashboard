{% extends 'layout.html' %}
{% block title %}Farmers{% endblock %}
{% block content %}
<div class="content-block">
    <h2>Farmer Management</h2>
    <p>Add new farmers and view farmers assigned to you.</p>
</div>

<div class="content-block">
    <h3>Add New Farmer</h3>
    <form action="{{ url_for('farmers') }}" method="post" enctype="multipart/form-data" class="styled-form">
        <input type="text" name="farmer_name" placeholder="Farmer Name" required>
        <input type="number" name="num_of_ponds" placeholder="Number of Ponds" required>
        <input type="date" name="doc" placeholder="Date of Culture (YYYY-MM-DD)">
        <input type="text" name="contact_details" placeholder="Contact Details" required>
        <input type="text" name="products_using" placeholder="Products Currently Using">
        <textarea name="notes" placeholder="Prescription / Notes"></textarea>
        
        <div class="form-group" style="grid-column: 1 / -1; display: flex; gap: 10px; align-items: center;">
            <input type="text" name="latitude" id="latitude" placeholder="Latitude">
            <input type="text" name="longitude" id="longitude" placeholder="Longitude">
            <button type="button" id="getLocationBtn" class="map-button" style="padding: 12px;">Get Location</button>
        </div>
        
        <input type="submit" value="Add Farmer" style="grid-column: 1 / -1;">
    </form>
</div>

<div class="content-block">
    <h3>Your Farmers</h3>
    <div class="table-container">
        <table class="styled-table">
            <thead>
                <tr>
                    <th>Farmer Name</th>
                    <th>Ponds</th>
                    <th>Contact</th>
                    <th>Days of Culture</th>
                    <th>Prescription / Notes</th>
                </tr>
            </thead>
            <tbody>
                {% for farmer in farmers %}
                <tr>
                    <td>{{ farmer.farmer_name }}</td>
                    <td>{{ farmer.num_of_ponds }}</td>
                    <td>{{ farmer.contact_details }}</td>
                    <td>
                        {% if farmer.doc %}
                            {{ (today - farmer.doc).days }}
                        {% else %}
                            N/A
                        {% endif %}
                    </td>
                    <td>{{ farmer.notes }}</td>
                    <td>
                        <a href="{{ url_for('farmer_details', farmer_id=farmer.id) }}" class="view-details">View Details</a>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
document.getElementById('getLocationBtn').addEventListener('click', function() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
            document.getElementById('latitude').value = position.coords.latitude.toFixed(6);
            document.getElementById('longitude').value = position.coords.longitude.toFixed(6);
        }, function() {
            alert('Error: The Geolocation service failed.');
        });
    } else {
        alert('Error: Your browser doesn\'t support geolocation.');
    }
});
</script>
{% endblock %}
